name: Node CI

on: 
  pull_request:
    branches:
    - master

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@master
    - name: Use Node.js 10.x
      uses: actions/setup-node@v1
      with:
        version: 10.x
    - name: install and build
      run: |
        yarn install
        yarn build

  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@master
    - name: Use Node.js 10.x
      uses: actions/setup-node@v1
      with:
        version: 10.x 
    - name: Install `ibmcloud` CLI
      run: |
      curl -fsSL https://clis.ng.bluemix.net/install/linux | sh
      ibmcloud login --apikey $CLOUD_API_KEY -a https://api.ng.bluemix.net -o carbon-design-system -s production
      ibmcloud cf add-plugin-repo CF-Community https://plugins.cloudfoundry.org
      ibmcloud cf install-plugin blue-green-deploy -f -r CF-Community

      ibmcloud cf blue-green-deploy carbon-website -f manifest.random.yml --delete-old-apps
